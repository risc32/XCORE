# Документация по использованию ядра XCore

## Общая информация

**XCore** - это операционная система с собственным ядром, написанным на C++. Ядро предоставляет базовые функции управления памятью, вводом-выводом, файловой системой и командами для взаимодействия с системой.

## Запуск системы

При загрузке ядро автоматически:
- Инициализирует обработчики исключений
- Настраивает консоль ввода-вывода
- Инициализирует драйвер диска
- Запускает автоматическое тестирование компонентов
- Монтирует файловую систему XCFS

После загрузки появляется приглашение командной строки `> `.

## Файловая система XCFS

XCore использует собственную файловую систему XCFS версии 2.1 с поддержкой:
- Дерева AVL для эффективного хранения файлов и директорий
- Битмапов для управления свободным пространством
- Метаданных файлов (разрешения, временные метки)
- Фрагментированного хранения данных

## Доступные команды

### Системные команды

#### `help`
Показывает список всех доступных команд.

#### `reboot`
Перезагружает систему.

#### `shutdown`
Выключает систему.

### Управление памятью (команды `ram`)

#### `ram info`
Показывает общую информацию о памяти:
- Размер heap-памяти
- Адрес heap
- Используемое и свободное пространство
- Количество блоков памяти

#### `ram showfree`
Показывает список свободных блоков памяти.

#### `ram get <идентификатор>`
Показывает информацию о конкретном блоке памяти.
Поддерживаемые форматы идентификаторов:
- `123` - по ID блока
- `@0x1234` - по абсолютному адресу
- `x1000` - по смещению от начала heap

#### `ram alloc <размер>`
Выделяет блок памяти указанного размера.

#### `ram realloc <блок> <новый_размер>`
Изменяет размер существующего блока памяти.

#### `ram free <блок>`
Освобождает блок памяти.

#### `ram place <адрес> <данные>`
Записывает данные по указанному адресу.

#### `ram snap <адрес>`
Показывает снимок памяти вокруг указанного адреса.

#### `ram browse <адрес>`
Интерактивный просмотр памяти:
- `w` - прокрутка вверх
- `s` - прокрутка вниз
- `пробел` - выход

### Работа с диском (команды `disk`)

#### `disk info`
Показывает информацию о диске и файловой системе:
- Версия XCFS
- Базовый порт
- Размер диска
- Размер сектора
- Общее количество секторов
- Поддержка LBA48

#### `disk readsec <сектор>`
Читает и отображает содержимое указанного сектора.

#### `disk writesec <сектор> <блок_памяти>`
Записывает данные из блока памяти в указанный сектор.

## Управление цветом в выводе

Ядро поддерживает цветной вывод через поток `KernelOut`:

```cpp
kout << RED << "Текст красным" << reset;
kout << bg(BLUE) << "Текст на синем фоне";
```

Доступные цвета: `BLACK`, `BLUE`, `GREEN`, `CYAN`, `RED`, `MAGENTA`, `BROWN`, `LIGHT_GRAY`, `DARK_GRAY`, `LIGHT_BLUE`, `LIGHT_GREEN`, `LIGHT_CYAN`, `LIGHT_RED`, `LIGHT_MAGENTA`, `YELLOW`, `WHITE`.

## Структура памяти

- **Heap**: 16MB статически выделенной памяти
- **Видеопамять**: 0xB8000 (текстовый режим 80x25)
- **Управление памятью**: блочный аллокатор с coalescing

## Особенности разработки

### Обработка исключений
Ядро включает полную систему обработки исключений процессора с дампом регистров и трассировкой стека.

### Потоковый ввод-вывод
Реализованы аналоги `iostream`:
- `KernelIn` для ввода
- `KernelOut` для вывода
- Поддержка манипуляторов (`hex`, `dec`, `endl`)

### Управляемые контейнеры
Шаблонный класс `managed<T>` предоставляет безопасные контейнеры с автоматическим управлением памятью.

## Форматирование диска

Если при загрузке обнаруживается неподдерживаемая файловая система, ядро предлагает отформатировать диск. Процесс форматирования включает:
1. Создание суперблока
2. Инициализацию битмапов
3. Создание корневой директории

## Отладка

Ядро включает встроенные инструменты отладки:
- Трассировка вызовов функций
- Дамп стека
- Просмотр состояния памяти
- Информация о блоках памяти

## Примеры использования

```bash
> ram info
> disk info
> ram alloc 1024
> ram get x1000
> help
```

Система предназначена для образовательных целей и демонстрации принципов работы операционных систем.